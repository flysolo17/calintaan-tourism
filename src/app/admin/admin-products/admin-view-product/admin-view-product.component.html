<mat-toolbar>
  <button mat-icon-button (click)="navigateBack()" aria-label="Back button">
    <mat-icon>arrow_back</mat-icon>
  </button>
  <span>View Product</span>

  <span class="example-spacer"></span>

  <button mat-icon-button color="accent" aria-label="Edit product">
    <mat-icon>edit</mat-icon>
  </button>
  <button mat-icon-button color="warn" aria-label="Delete product">
    <mat-icon>delete</mat-icon>
  </button>
</mat-toolbar>

<mat-progress-bar *ngIf="loading$" mode="indeterminate"></mat-progress-bar>

<div *ngIf="!loading$ && product" class="container">
  <div
    class="product-header"
    fxLayout="row"
    fxLayoutGap="24px"
    fxLayoutAlign="start center"
    style="margin-top: 16px"
  >
    <img
      [src]="product.imageUrl"
      alt="{{ product.name }}"
      width="200"
      height="200"
      style="border-radius: 1rem; object-fit: cover"
    />

    <div class="product-info" fxFlex>
      <h1>{{ product.name }}</h1>

      <div class="inventory-actions" style="margin-top: 1rem">
        <button
          mat-flat-button
          (click)="updateStocks('out')"
          color="warn"
          style="height: 48px; padding: 0 2rem; border-radius: 2rem"
        >
          <mat-icon style="padding-right: 1rem">inventory_2</mat-icon> OUT
        </button>

        <button
          mat-flat-button
          (click)="updateStocks('in')"
          color="primary"
          style="
            height: 48px;
            padding: 0 2rem;
            border-radius: 2rem;
            margin-left: 1rem;
          "
        >
          <mat-icon style="padding-right: 1rem">inventory_2</mat-icon> IN
        </button>
      </div>
    </div>
  </div>

  <mat-tab-group
    mat-stretch-tabs="false"
    mat-align-tabs="center"
    style="margin-top: 2rem; width: 100%"
  >
    <mat-tab label="Information" style="width: 100%">
      <section
        class="product-information"
        style="padding: 1rem; max-width: 600px"
      >
        <h2>Product Information</h2>

        <mat-divider style="width: 100%"></mat-divider>

        <div class="info-row">
          <strong>SKU: </strong>
          <span>{{ product.sku }}</span>
        </div>

        <div class="info-row">
          <strong>Category: </strong>
          <span>{{ product.category }}</span>
        </div>

        <div class="info-row description">
          <strong>Description: </strong>
          <p>{{ product.description }}</p>
        </div>

        <div>
          <strong>Price: </strong>
          <span>{{ product.price | currency : "PHP" }}</span>
        </div>

        <div>
          <strong>Cost: </strong>
          <span>{{ product.cost | currency : "PHP" }}</span>
        </div>

        <div
          class="info-row stock"
          [ngClass]="{
            'low-stock': product.stock <= product.stockAlert.lowStockQuantity
          }"
        >
          <strong>Stock: </strong>
          <span>{{ product.stock }}</span>
          <mat-icon
            *ngIf="product.stock <= product.stockAlert.lowStockQuantity"
            color="warn"
            matTooltip="Stock below alert threshold!"
            aria-label="Low stock warning"
            style="vertical-align: middle; margin-left: 4px"
          >
            warning
          </mat-icon>
        </div>
      </section>
    </mat-tab>

    <mat-tab label="Transactions"> Transactions </mat-tab>

    <mat-tab label="Logs">
      <table
        mat-table
        [dataSource]="audits$"
        class="mat-elevation-z8 demo-table"
      >
        @for (column of auditColumns; track column) {
        <ng-container [matColumnDef]="column.columnDef">
          <th mat-header-cell *matHeaderCellDef>
            {{ column.header }}
          </th>
          <td mat-cell *matCellDef="let row">
            {{ column.cell(row) }}
          </td>
        </ng-container>
        }

        <tr mat-header-row *matHeaderRowDef="displayedAuditColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedAuditColumns"></tr>
      </table>
    </mat-tab>
  </mat-tab-group>
</div>

<div
  *ngIf="!loading$ && !product"
  class="error-container"
  style="text-align: center; margin-top: 3rem"
>
  <mat-icon style="width: 7rem; height: 7rem; font-size: 6rem; color: gainsboro"
    >inventory_2</mat-icon
  >
  <span>Sorry, the product youâ€™re looking for cannot be found.</span>
  <button mat-flat-button color="primary" (click)="navigateBack()">
    <mat-icon style="padding-right: 1rem">arrow_back</mat-icon>
    Back
  </button>
</div>
